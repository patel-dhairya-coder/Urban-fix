<!-- admin_dashboard/templates/admin_dashboard/contractor_form.html -->
{% extends "admin_dashboard/base.html" %}

{% block title %}{% if contractor.id %}Edit Contractor{% else %}Add Contractor{% endif %}{% endblock %}
{% block page_title %}{% if contractor.id %}Edit Contractor: {{ contractor.name }}{% else %}Add New Contractor{% endif %}{% endblock %}

{% block content %}
<div class="bg-white rounded-lg shadow-md p-6 max-w-xl mx-auto">
    <div class="flex justify-between items-center mb-6 border-b pb-4">
        <h2 class="text-xl font-semibold text-gray-800">{% if contractor.id %}Edit Contractor Details{% else %}New Contractor Information{% endif %}</h2>
        <a href="{% url 'admin_dashboard:contractor_list' %}" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md shadow-md">
            <i class="fas fa-arrow-left mr-2"></i> Back to List
        </a>
    </div>

    <form method="POST" action="{% if contractor.id %}{% url 'admin_dashboard:edit_contractor' contractor_id=contractor.id %}{% else %}{% url 'admin_dashboard:add_contractor' %}{% endif %}">
        {% csrf_token %}

        <div class="mb-4">
            <label for="name" class="block text-gray-700 text-sm font-bold mb-2">Contractor Name <span class="text-red-500">*</span></label>
            <input type="text" id="name" name="name"
                   class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   value="{{ contractor.name|default:'' }}" required>
        </div>

        <div class="mb-4">
            <label for="email" class="block text-gray-700 text-sm font-bold mb-2">Login Email <span class="text-red-500">*</span></label>
            <input type="email" id="email" name="email"
                   class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   value="{{ contractor.email|default:'' }}" required>
        </div>

        <!-- NEW: Password Field -->
        <div class="mb-4">
            <label for="password" class="block text-gray-700 text-sm font-bold mb-2">
                Password 
                {% if not contractor.id %}
                    <span class="text-red-500">*</span>
                {% else %}
                    <span class="text-gray-500 text-xs">(Leave blank to keep unchanged)</span>
                {% endif %}
            </label>
            <input type="password" id="password" name="password"
                   class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   {% if not contractor.id %}required{% endif %}>
        </div>
        <!-- END NEW -->

        <div class="mb-4">
            <label for="contact_number" class="block text-gray-700 text-sm font-bold mb-2">Contact Number</label>
            <input type="text" id="contact_number" name="contact_number"
                   class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   value="{{ contractor.contact_number|default:'' }}">
        </div>

        <div class="mb-4">
            <label for="specialization" class="block text-gray-700 text-sm font-bold mb-2">Specialization <span class="text-red-500">*</span></label>
            <select id="specialization" name="specialization"
                    class="block w-full border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-700 focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                    required>
                <option value="">Select Specialization</option>
                {% for key, value in specialization_choices %}
                    <option value="{{ key }}" {% if contractor.specialization == key %}selected{% endif %}>{{ value }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-4">
            <label for="area_assigned" class="block text-gray-700 text-sm font-bold mb-2">Area Assigned</label>
            <input type="text" id="area_assigned" name="area_assigned"
                   class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   value="{{ contractor.area_assigned|default:'' }}"
                   placeholder="e.g., North Zone, Sector 5, All">
        </div>

        <div class="mb-6 flex items-center">
            <input type="checkbox" id="is_active" name="is_active"
                   class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                   {% if contractor.is_active or not contractor.id %}checked{% endif %}> <!-- Default to checked for new or active -->
            <label for="is_active" class="ml-2 block text-gray-900 text-sm">Active Contractor</label>
        </div>

        <div class="flex items-center justify-end">
            <button type="submit"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
                {% if contractor.id %}<i class="fas fa-save mr-2"></i> Update Contractor{% else %}<i class="fas fa-plus-circle mr-2"></i> Add Contractor{% endif %}
            </button>
        </div>
    </form>
</div>
{% endblock %}
